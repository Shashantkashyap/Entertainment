import React, { useEffect, useState } from 'react'
import fetchData from '../api/ApiHit';
import LoadingPage from "../components/Loading"
import { useDispatch } from "react-redux";
import { selectedCard } from "../redux/cardSlice";
import { useNavigate } from 'react-router-dom';


function Movies() {

    const [movies, setMovie] = useState([]);
    const [loading, setLoading] = useState(true); // State to track loading
    const imageUri = "https://image.tmdb.org/t/p/original";
    const dispatch = useDispatch();
  const navigate = useNavigate();
   
    async function getPopularMovies(){
        setLoading(true); // Set loading state to true when fetching data
        const data = await fetchData("movie/popular");
        setMovie(data.results);
        setLoading(false); // Set loading state to false when data fetching is complete
    }
      
    useEffect(() => {
        getPopularMovies();
    }, []);

    console.log(movies);

    return (
        <div className='grid grid-cols-7 max-md:grid-cols-4 max-sm:grid-cols-2 gap-2'>
            {loading ? (
                <LoadingPage /> // Show loading page while data is fetching
            ) : (
                movies.map((movie) => (
                    <div key={movie.id} className='flex flex-col items-center'
                    onClick={() => {
                        dispatch(selectedCard(movie.id));
                        navigate("/details");
                      }}
                    >
                        <img src={`${imageUri}/${movie.poster_path}`} alt={movie.title} className='w-[140px] rounded-lg'/>
                        <p className='text-center text-white mb-3 font-semibold mt-2'>{movie.title}</p>
                    </div>
                ))
            )}
        </div>
    );
}

export default Movies;
